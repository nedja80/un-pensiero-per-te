!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auguri Speciali</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Arial Rounded MT Bold', 'Segoe UI', sans-serif;
            background: radial-gradient(circle at top, #ffe9f7 0%, #ffb3d9 40%, #ff7fa3 100%);
            height: 100vh;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        #click-area {
            position: fixed;
            inset: 0;
            cursor: pointer;
        }

        h1 {
            position: absolute;
            top: 7%;
            width: 100%;
            text-align: center;
            color: #ffffff;
            font-weight: 800;
            font-size: clamp(1.8rem, 5vw, 3rem);
            text-shadow: 0 0 10px rgba(255,255,255,0.9), 0 0 25px rgba(255,105,180,0.8);
            pointer-events: none;
            padding: 0 1rem;
            z-index: 10;
        }

        .subtitle {
            position: absolute;
            top: 17%;
            width: 100%;
            text-align: center;
            color: #fffafc;
            font-size: clamp(1rem, 3vw, 1.4rem);
            text-shadow: 0 0 8px rgba(0,0,0,0.2);
            pointer-events: none;
            padding: 0 1rem;
            z-index: 10;
        }

        .cat-wrapper {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 18px;
            z-index: 10;
        }

        .cat-halo {
            position: absolute;
            width: 160%;
            height: 160%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.7), transparent);
            filter: blur(2px);
            pointer-events: none;
            z-index: 1;
        }

        .main-icon {
            width: min(190px, 50vw);
            max-width: 220px;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(255,255,255,0.9), 0 0 40px rgba(255,155,200,1);
            pointer-events: none;
            border: 3px solid white;
            z-index: 2;
        }

        #cat {
            width: min(120px, 30vw);
            max-width: 140px;
            border-radius: 35%;
            box-shadow: 0 0 10px rgba(255,255,255,0.9), 0 0 25px rgba(255,155,200,0.9);
            cursor: pointer;
            transition: transform 0.2s ease-out;
            background: rgba(255,255,255,0.8);
            border: 2px solid white;
            z-index: 3;
        }

        #cat:active { transform: scale(1.05); }

        .ball, .explosion, .flower, .message {
            position: absolute;
            pointer-events: none;
            z-index: 5;
        }

        .ball {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: radial-gradient(circle, #ffffff, #ffe066, #ff9d00);
            box-shadow: 0 0 10px #fff, 0 0 25px #ffe066, 0 0 45px #ff9d00;
        }

        .explosion {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,1), rgba(255,192,203,0.6), transparent);
            opacity: 0.9;
        }

        .flower {
            width: 70px;
            height: 70px;
            filter: drop-shadow(0 0 8px rgba(255,255,255,0.9));
        }

        .message {
            color: #ffffff;
            font-weight: 800;
            font-size: clamp(1.4rem, 4.5vw, 2.2rem);
            text-align: center;
            text-shadow: 0 0 8px rgba(255,255,255,1), 0 0 20px rgba(255,105,180,0.9);
            opacity: 0;
            width: 260px;
            margin-left: -130px;
            z-index: 15;
        }

        .tap-hint {
            position: absolute;
            bottom: 4%;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 0.4rem;
            color: #fff;
            font-size: clamp(0.9rem, 2.8vw, 1.2rem);
            opacity: 0.8;
            animation: pulse 1.5s infinite;
            pointer-events: none;
            z-index: 10;
        }

        .tap-icon { font-size: 1.4em; }

        @keyframes pulse {
            0%, 100% { transform: translateX(-50%) scale(1); opacity: 0.4; }
            50% { transform: translateX(-50%) scale(1.08); opacity: 1; }
        }

        .download-btn {
            position: absolute;
            bottom: 11%;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 999px;
            border: none;
            background: linear-gradient(135deg, #ff7ac4, #ff5cb8);
            color: #fff;
            font-size: 1rem;
            font-weight: 700;
            box-shadow: 0 0 15px rgba(255,255,255,0.9), 0 4px 10px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            transform: translateX(-50%) scale(1.05);
            box-shadow: 0 0 20px rgba(255,255,255,1), 0 6px 15px rgba(0,0,0,0.3);
        }

        .download-btn:active {
            transform: translateX(-50%) scale(0.95);
        }

        .audio-notice {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255,255,255,0.9);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #ff5cb8;
            z-index: 1000;
            animation: fadeOut 3s forwards;
            display: none;
        }

        @keyframes fadeOut {
            0%, 70% { opacity: 1; }
            100% { opacity: 0; display: none; }
        }
    </style>
</head>
<body>
    <!-- Notifica audio -->
    <div id="audioNotice" class="audio-notice" role="alert" aria-live="polite">
        Clicca per attivare l'audio
    </div>

    <!-- Audio -->
    <audio id="clickSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-magic-sparkle-sound-3080.mp3" type="audio/mpeg">
    </audio>
    <audio id="purrSound" preload="auto" loop>
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-cat-purring-close-1963.mp3" type="audio/mpeg">
    </audio>
    <audio id="bgMusic" preload="auto" loop>
        <source src="https://assets.mixkit.co/music/preview/mixkit-a-very-happy-christmas-897.mp3" type="audio/mpeg">
    </audio>

    <div id="click-area" role="button" aria-label="Tocca per auguri">
        <h1>Auguri Speciali</h1>
        <p class="subtitle">Porta un sorriso a chi vuoiâ€¦ tocca lo schermo o accarezza il gattino.</p>

        <div class="cat-wrapper">
            <div class="cat-halo"></div>
            <img class="main-icon" src="https://cdn-icons-png.flaticon.com/512/733/733585.png" alt="Icona WhatsApp" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIHJ4PSIxMDAiIGZpbGw9IiMyNUQyODYiLz48cGF0aCBkPSJNMTQwIDgwQzE0MCA2Mi4zOTM4IDEwNy42MDYgMzAgNzAgMzBDMzIuMzkzOCAzMCAwIDYyLjM5MzggMCAxMDBDMCAxMTguMzI3IDkuMzI3NTYgMTM0LjY0NiAyNCAxNDQuNDQ4VjE2Nkw1MS41NTIgMTU1LjU1MkM2MC4wNzM2IDE1OC40NjIgNjkuNTI3NiAxNjAgODAgMTYwQzExNy42MDYgMTYwIDE1MCAxMjcuNjA2IDE1MCA5MEgxNDBaIiBmaWxsPSJ3aGl0ZSIvPjxwYXRoIGQ9Ik02MCA3MEM1NS41ODE3IDcwIDUyIDczLjU4MTcgNTIgNzhWOTBDNTIgOTQuNDE4MyA1NS41ODE3IDk4IDYwIDk4SDgyQzg2LjQxODMgOTggOTAgOTQuNDE4MyA5MCA5MFY3OEM5MCA3My41ODE3IDg2LjQxODMgNzAgODIgNzBINjBaIiBmaWxsPSJ3aGl0ZSIvPjwvc3ZnPg=='">
            <img id="cat" src="https://cdn-icons-png.flaticon.com/512/220/220236.png" alt="Gattino carino" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSIxMjAiIHJ4PSI0MiIgZmlsbD0iI0ZGRiIvPjxwYXRoIGQ9Ik00MCA1MEM0MCA1Mi4yMDkxIDM4LjIwOTEgNTQgMzYgNTRDMzMuNzkwOSA1NCAzMiA1Mi4yMDkxIDMyIDUwQzMyIDQ3Ljc5MDkgMzMuNzkwOSA0NiAzNiA0NkMzOC4yMDkxIDQ2IDQwIDQ3Ljc5MDkgNDAgNTBaIiBmaWxsPSIjMzMzIi8+PHBhdGggZD0iTTg4IDUwQzg4IDUyLjIwOTEgODYuMjA5MSA1NCA4NCA1NEM4MS43OTA5IDU0IDgwIDUyLjIwOTEgODAgNTBDODAgNDcuNzkwOSA4MS43OTA5IDQ2IDg0IDQ2Qzg2LjIwOTEgNDYgODggNDcuNzkwOSA4OCA1MFoiIGZpbGw9IiMzMzMiLz48cGF0aCBkPSJNNjAgNzBDNjUuNTIyOCA3MCA3MCA2NS41MjI4IDcwIDYwSDUwQzUwIDY1LjUyMjggNTQuNDc3MiA3MCA2MCA3MFoiIGZpbGw9IiNGRjZDNzciLz48cGF0aCBkPSJNNDUgODBDNDUgODIuNzYxNCA0Mi43NjE0IDg1IDQwIDg1QzM3LjIzODYgODUgMzUgODIuNzYxNCAzNSA4MEMzNSA3Ny4yMzg2IDM3LjIzODYgNzUgNDAgNzVDNDIuNzYxNCA3NSA0NSA3Ny4yMzg2IDQ1IDgwWiIgZmlsbD0iI0ZGNkM3NyIvPjxwYXRoIGQ9Ik04NSA4MEM4NSA4Mi43NjE0IDgyLjc2MTQgODUgODAgODVDNzcuMjM4NiA4NSA3NSA4Mi43NjE0IDc1IDgwQzc1IDc3LjIzODYgNzcuMjM4NiA3NSA4MCA3NUw4Mi43NjE0IDc1IDg1IDc3LjIzODYgODUgODBaIiBmaWxsPSIjRkY2Qzc3Ii8+PC9zdmc+'">
        </div>

        <button id="downloadBtn" class="download-btn" aria-label="Scarica questa sorpresa">
            Scarica questa sorpresa
        </button>

        <div class="tap-hint" aria-hidden="true">
            <span class="tap-icon">Tocca</span>
            <span>tocca per iniziare</span>
        </div>
    </div>

    <script>
        // === SALVA IL CODICE COMPLETO PER IL DOWNLOAD ===
        const FULL_HTML = `<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auguri Speciali</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"><\/script>
    <style>
        ${document.querySelector('style').innerHTML}
    </style>
</head>
<body>
    ${document.getElementById('click-area').outerHTML.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')}
    <audio id="clickSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-magic-sparkle-sound-3080.mp3" type="audio/mpeg">
    </audio>
    <audio id="purrSound" preload="auto" loop">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-cat-purring-close-1963.mp3" type="audio/mpeg">
    </audio>
    <audio id="bgMusic" preload="auto" loop">
        <source src="https://assets.mixkit.co/music/preview/mixkit-a-very-happy-christmas-897.mp3" type="audio/mpeg">
    </audio>
    <script>
        ${document.querySelector('script').innerHTML}
    <\/script>
</body>
</html>`.replace(/<\/script>/g, '<\\/script>');

        document.addEventListener('DOMContentLoaded', function() {
            const clickArea = document.getElementById("click-area");
            const cat = document.getElementById("cat");
            const clickSound = document.getElementById("clickSound");
            const purrSound = document.getElementById("purrSound");
            const bgMusic = document.getElementById("bgMusic");
            const downloadBtn = document.getElementById("downloadBtn");
            const audioNotice = document.getElementById("audioNotice");

            let audioEnabled = false;

            // Mostra notifica
            audioNotice.style.display = 'block';
            setTimeout(() => audioNotice.style.display = 'none', 3000);

            function enableAudio() {
                if (audioEnabled) return;
                audioEnabled = true;
                [bgMusic, purrSound, clickSound].forEach(a => a.volume = 0.4);
                bgMusic.play().catch(() => {});
                audioNotice.style.display = 'none';
            }

            // Abilita audio al primo tocco
            const enableOnFirst = () => { enableAudio(); document.removeEventListener('click', enableOnFirst); document.removeEventListener('touchstart', enableOnFirst); };
            document.addEventListener('click', enableOnFirst);
            document.addEventListener('touchstart', enableOnFirst);

            // Click/touch generale
            const handleClick = (e) => {
                if (e.target === cat || e.target === downloadBtn) return;
                const x = e.clientX || e.touches[0].clientX;
                const y = e.clientY || e.touches[0].clientY;
                enableAudio();
                launchBall(x, y);
            };
            clickArea.addEventListener("click", handleClick);
            clickArea.addEventListener("touchstart", (e) => { e.preventDefault(); handleClick(e); });

            // Gattino
            const handleCat = () => {
                enableAudio();
                const rect = cat.getBoundingClientRect();
                const x = rect.left + rect.width / 2;
                const y = rect.top + rect.height / 2;

                anime({ targets: cat, scale: [1, 1.08, 1], duration: 800, easing: "easeInOutQuad" });
                if (purrSound.paused) purrSound.play().catch(() => {});
                explosionAt(x, y);
                flowersAt(x, y);
                showMessage(x, y, "Prrrr... ðŸ’–");
            };
            cat.addEventListener("click", handleCat);
            cat.addEventListener("touchstart", (e) => { e.preventDefault(); handleCat(); });

            // DOWNLOAD FUNZIONANTE
            downloadBtn.addEventListener("click", (e) => {
                e.stopPropagation();
                enableAudio();
                const blob = new Blob([FULL_HTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'auguri-speciali.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });

            // === ANIMAZIONI ===
            function launchBall(x, y) {
                if (audioEnabled) clickSound.play().catch(() => {});
                const ball = Object.assign(document.createElement("div"), { className: "ball" });
                document.body.appendChild(ball);
                ball.style.left = innerWidth / 2 + "px";
                ball.style.top = innerHeight + 30 + "px";

                anime({
                    targets: ball,
                    left: x, top: y,
                    duration: 1100,
                    easing: "easeOutQuad",
                    complete: () => { ball.remove(); explosionAt(x, y); flowersAt(x, y); showMessage(x, y, "Auguri! ðŸ’«"); }
                });
            }

            function explosionAt(x, y) {
                const boom = Object.assign(document.createElement("div"), { className: "explosion" });
                boom.style.left = x + "px"; boom.style.top = y + "px";
                document.body.appendChild(boom);
                anime({
                    targets: boom,
                    width: [20, 250], height: [20, 250],
                    marginLeft: [-10, -125], marginTop: [-10, -125],
                    opacity: [0.9, 0],
                    easing: "easeOutExpo", duration: 900,
                    complete: () => boom.remove()
                });
            }

            function flowersAt(x, y) {
                for (let i = 0; i < 12; i++) {
                    setTimeout(() => {
                        const f = Object.assign(document.createElement("img"), { className: "flower", src: "https://cdn-icons-png.flaticon.com/512/4822/4822083.png" });
                        document.body.appendChild(f);
                        const a = (Math.PI * 2 * i) / 12;
                        const d = 80 + Math.random() * 100;
                        const fx = x + Math.cos(a) * d;
                        const fy = y + Math.sin(a) * d;
                        f.style.left = x + "px"; f.style.top = y + "px";
                        anime({
                            targets: f,
                            left: fx, top: fy,
                            opacity: [1, 0], scale: [0.3, 1], rotate: Math.random() * 360,
                            easing: "easeOutExpo", duration: 2000,
                            complete: () => f.remove()
                        });
                    }, i * 100);
                }
            }

            function showMessage(x, y, text) {
                const msg = Object.assign(document.createElement("div"), { className: "message", textContent: text });
                msg.style.left = x + "px"; msg.style.top = y + "px";
                document.body.appendChild(msg);
                anime({
                    targets: msg,
                    opacity: [0, 1], translateY: [20, -10], scale: [0.8, 1.1],
                    duration: 1300, easing: "easeOutBack",
                    complete: () => anime({
                        targets: msg,
                        opacity: [1, 0], translateY: [-10, -30],
                        duration: 1200, delay: 900, easing: "easeInQuad",
                        complete: () => msg.remove()
                    })
                });
            }
        });
    </script>
</body>
</html>
